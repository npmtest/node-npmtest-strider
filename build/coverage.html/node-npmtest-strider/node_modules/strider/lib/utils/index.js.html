<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for node-npmtest-strider/node_modules/strider/lib/utils/index.js</title>
    <meta charset="utf-8">
    <style>
        body, html {
            margin:0; padding: 0;
        }
        body {
            font-family: Arial, Helvetica;
            font-size: 10pt;
        }
        div.header, div.footer {
            background: #eee;
            padding: 1em;
        }
        div.header {
            height: 160px;
            padding: 0 1em 0 1em;
            z-index: 100;
            position: fixed;
            top: 0;
            border-bottom: 1px solid #666;
            width: 100%;
        }
        div.footer {
            border-top: 1px solid #666;
        }
        div.body {
            margin-top: 170px;
        }
        div.meta {
            font-size: 90%;
            text-align: center;
        }
        h1, h2, h3 {
            font-weight: normal;
        }
        h1 {
            font-size: 12pt;
        }
        h2 {
            font-size: 10pt;
        }
        pre {
            font-family: Menlo, Monaco, Consolas, Courier New, monospace;
            margin: 0;
            padding: 0;
            font-size: 14px;
            tab-size: 2;
        }

        div.path { font-size: 110%; }
        div.path a:link, div.path a:visited { color: #000; }
        table.coverage { border-collapse: collapse; margin:0; padding: 0 }

        table.coverage td {
            margin: 0;
            padding: 0;
            color: #111;
            vertical-align: top;
        }
        table.coverage td.line-count {
            width: 50px;
            text-align: right;
            padding-right: 5px;
        }
        table.coverage td.line-coverage {
            color: #777 !important;
            text-align: right;
            border-left: 1px solid #666;
            border-right: 1px solid #666;
        }

        table.coverage td.text {
        }

        table.coverage td span.cline-any {
            display: inline-block;
            padding: 0 5px;
            width: 40px;
        }
        table.coverage td span.cline-neutral {
            background: #eee;
        }
        table.coverage td span.cline-yes {
            background: #b5d592;
            color: #999;
        }
        table.coverage td span.cline-no {
            background: #fc8c84;
        }

        .cstat-yes { color: #111; }
        .cstat-no { background: #fc8c84; color: #111; }
        .fstat-no { background: #ffc520; color: #111 !important; }
        .cbranch-no { background:  yellow !important; color: #111; }

        .cstat-skip { background: #ddd; color: #111; }
        .fstat-skip { background: #ddd; color: #111 !important; }
        .cbranch-skip { background: #ddd !important; color: #111; }

        .missing-if-branch {
            display: inline-block;
            margin-right: 10px;
            position: relative;
            padding: 0 4px;
            background: black;
            color: yellow;
        }

        .skip-if-branch {
            display: none;
            margin-right: 10px;
            position: relative;
            padding: 0 4px;
            background: #ccc;
            color: white;
        }

        .missing-if-branch .typ, .skip-if-branch .typ {
            color: inherit !important;
        }

        .entity, .metric { font-weight: bold; }
        .metric { display: inline-block; border: 1px solid #333; padding: 0.3em; background: white; }
        .metric small { font-size: 80%; font-weight: normal; color: #666; }

        div.coverage-summary table { border-collapse: collapse; margin: 3em; font-size: 110%; }
        div.coverage-summary td, div.coverage-summary table  th { margin: 0; padding: 0.25em 1em; border-top: 1px solid #666; border-bottom: 1px solid #666; }
        div.coverage-summary th { text-align: left; border: 1px solid #666; background: #eee; font-weight: normal; }
        div.coverage-summary th.file { border-right: none !important; }
        div.coverage-summary th.pic { border-left: none !important; text-align: right; }
        div.coverage-summary th.pct { border-right: none !important; }
        div.coverage-summary th.abs { border-left: none !important; text-align: right; }
        div.coverage-summary td.pct { text-align: right; border-left: 1px solid #666; }
        div.coverage-summary td.abs { text-align: right; font-size: 90%; color: #444; border-right: 1px solid #666; }
        div.coverage-summary td.file { text-align: right; border-left: 1px solid #666; white-space: nowrap;  }
        div.coverage-summary td.pic { min-width: 120px !important;  }
        div.coverage-summary a:link { color: #000; }
        div.coverage-summary a:visited { color: #333; }
        div.coverage-summary tfoot td { border-top: 1px solid #666; }

        div.coverage-summary .yui3-datatable-sort-indicator, div.coverage-summary .dummy-sort-indicator {
            height: 10px;
            width: 7px;
            display: inline-block;
            margin-left: 0.5em;
        }
        div.coverage-summary .yui3-datatable-sort-indicator {
            background: no-repeat scroll 0 0 transparent;
        }
        div.coverage-summary .yui3-datatable-sorted .yui3-datatable-sort-indicator {
            background-position: 0 -20px;
        }
        div.coverage-summary .yui3-datatable-sorted-desc .yui3-datatable-sort-indicator {
            background-position: 0 -10px;
        }

        .high { background: #b5d592 !important; }
        .medium { background: #ffe87c !important; }
        .low { background: #fc8c84 !important; }

        span.cover-fill, span.cover-empty {
            display:inline-block;
            border:1px solid #444;
            background: white;
            height: 12px;
        }
        span.cover-fill {
            background: #ccc;
            border-right: 1px solid #444;
        }
        span.cover-empty {
            background: white;
            border-left: none;
        }
        span.cover-full {
            border-right: none !important;
        }
        pre.prettyprint {
            border: none !important;
            padding: 0 !important;
            margin: 0 !important;
        }
        .com { color: #999 !important; }
        .ignore-none { color: #999; font-weight: normal; }

    </style>
</head>
<body>
<div class="header low">
    <h1 style="font-weight: bold;">
        <a href="https://github.com/npmtest/node-npmtest-strider">npmtest-strider (v0.0.1)</a>
    </h1>
    <h1>Code coverage report for <span class="entity">node-npmtest-strider/node_modules/strider/lib/utils/index.js</span></h1>
    <h2>
        
        Statements: <span class="metric">13.28% <small>(17 / 128)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        
        
        Branches: <span class="metric">0% <small>(0 / 76)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        
        
        Functions: <span class="metric">0% <small>(0 / 14)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        
        
        Lines: <span class="metric">15.89% <small>(17 / 107)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        
        Ignored: <span class="metric"><span class="ignore-none">none</span></span> &nbsp;&nbsp;&nbsp;&nbsp;
    </h2>
    <div class="path"><a href="../../../../../index.html">All files</a> &#187; <a href="index.html">node-npmtest-strider/node_modules/strider/lib/utils/</a> &#187; index.js</div>
</div>
<div class="body">
<pre><table class="coverage">
<tr><td class="line-count">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221</td><td class="line-coverage"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">'use strict';
&nbsp;
var _ = require('lodash');
var common = require('../../lib/common');
var debug = require('debug')('strider:utils');
var gravatar = require('gravatar');
&nbsp;
module.exports = {
  gravatar: gravatarDefault,
  sanitizeProject: sanitizeProject,
  sanitizeBranch: sanitizeBranch,
  sanitizeUser: sanitizeUser,
  timeFromId: timeFromId,
  defaultSchema: defaultSchema,
  validateAgainstSchema: validateAgainstSchema,
  mergePlugins: mergePlugins,
  mergeConfigs: mergeConfigs,
  findBranch: findBranch
};
&nbsp;
<span class="fstat-no" title="function not covered" >function findBranch(branches, name) {</span>
<span class="cstat-no" title="statement not covered" >  var foundBranch = false;</span>
<span class="cstat-no" title="statement not covered" >  branches.some(<span class="fstat-no" title="function not covered" >function (branch) {</span></span>
<span class="cstat-no" title="statement not covered" >    if (branch.name) {</span>
<span class="cstat-no" title="statement not covered" >      var regEx = new RegExp(`^${branch.name.replace(/\*/g, '.*')}$`);</span>
<span class="cstat-no" title="statement not covered" >      if (regEx.test(name)) {</span>
<span class="cstat-no" title="statement not covered" >        foundBranch = branch;</span>
<span class="cstat-no" title="statement not covered" >        return true;</span>
      }
    }
  });
<span class="cstat-no" title="statement not covered" >  return (<span class="fstat-no" title="function not covered" >function discreteBranchFn(name, branch, branches) {</span></span>
    //console.log('findBranch('+name+') wants to return '+branch.name);
<span class="cstat-no" title="statement not covered" >    if (branch.name !== name) {</span>
      //console.warn('Possibly returning unintended branch (expected '+name+' but got '+branch.name+'). attempting to locate discretely named branch '+name+' if it exists.');
<span class="cstat-no" title="statement not covered" >      var discreteBranch = _.find(branches, {name: name});</span>
<span class="cstat-no" title="statement not covered" >      if (discreteBranch) {</span>
<span class="cstat-no" title="statement not covered" >        branch = discreteBranch;</span>
        //console.info("Located discrete branch, instead returning "+branch.name)
      } else {
        //console.warn("Unable to find discrete branch "+name+", still returning "+branch.name);
      }
    }
<span class="cstat-no" title="statement not covered" >    return branch;</span>
  }(name, foundBranch, branches));
}
&nbsp;
// merge plugins from the DB with ones from strider.json. The latter overrides the former
<span class="fstat-no" title="function not covered" >function mergePlugins(branch, sjson) {</span>
<span class="cstat-no" title="statement not covered" >  if (!branch) <span class="cstat-no" title="statement not covered" >return sjson;</span></span>
<span class="cstat-no" title="statement not covered" >  if (!sjson) <span class="cstat-no" title="statement not covered" >return branch;</span></span>
  // if strict_plugins is not turned on, we merge each plugin config instead of overwriting.
<span class="cstat-no" title="statement not covered" >  var plugins = [];</span>
<span class="cstat-no" title="statement not covered" >  var pluginMap = {};</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >  for (var pluginIndex = 0; pluginIndex &lt; sjson.length; pluginIndex++) {</span>
<span class="cstat-no" title="statement not covered" >    plugins.push(sjson[pluginIndex]);</span>
<span class="cstat-no" title="statement not covered" >    pluginMap[sjson[pluginIndex].id] = true;</span>
  }
<span class="cstat-no" title="statement not covered" >  for (var branchIndex = 0; branchIndex &lt; branch.length; branchIndex++) {</span>
<span class="cstat-no" title="statement not covered" >    if (!pluginMap[branch[branchIndex].id]) <span class="cstat-no" title="statement not covered" >plugins.push(branch[branchIndex]);</span></span>
  }
<span class="cstat-no" title="statement not covered" >  return plugins;</span>
}
&nbsp;
<span class="fstat-no" title="function not covered" >function mergeConfigs(branch, striderJson) {</span>
  // Is this still a mongoose document?
<span class="cstat-no" title="statement not covered" >  if (typeof branch.toObject === 'function') {</span>
<span class="cstat-no" title="statement not covered" >    branch = branch.toObject();</span>
  }
&nbsp;
  // Copy all properties of the branch configuration to a new object (inherited properties are ignored, there
  // shouldn't be any anyway). Then override all values with what is defined in the strider.json.
  // Note that this overrides all plugin configuration.
<span class="cstat-no" title="statement not covered" >  const config = _.assign({}, branch, striderJson);</span>
&nbsp;
  // Get a list of all plugins and their default configuration schemas.
  // We can find these in common.extensions, which contains separate objects for every type of extension that exists.
  // In those objects we find keys which are the IDs of the plugin and the value is the configuration schema of that
  // plugin.
  // We recursively traverse this data structure and merge it into a single hash, while generating an instance of the
  // default configuration, so we can access the configurations for each extension easily.
<span class="cstat-no" title="statement not covered" >  const allSchemas = _.keys(common.extensions).reduce((allSchemas, extensionType) =&gt; {</span>
<span class="cstat-no" title="statement not covered" >    _.keys(common.extensions[extensionType]).reduce((allSchemas, pluginId) =&gt; {</span>
<span class="cstat-no" title="statement not covered" >      if(extensionType === 'runner') <span class="cstat-no" title="statement not covered" >return allSchemas;</span></span>
<span class="cstat-no" title="statement not covered" >      allSchemas[pluginId] = defaultSchema(common.extensions[extensionType][pluginId]);</span>
<span class="cstat-no" title="statement not covered" >      return allSchemas;</span>
    }, allSchemas);
<span class="cstat-no" title="statement not covered" >    return allSchemas;</span>
  }, {});
&nbsp;
  // For every plugin, merge the default configuration into a new object and then assign the user configuration
  // over it.
<span class="cstat-no" title="statement not covered" >  if(config.plugins &amp;&amp; config.plugins.length) {</span>
<span class="cstat-no" title="statement not covered" >    config.plugins.forEach(plugin =&gt; {</span>
<span class="cstat-no" title="statement not covered" >      if(!allSchemas[plugin.id]) <span class="cstat-no" title="statement not covered" >return plugin.config;</span></span>
<span class="cstat-no" title="statement not covered" >      plugin.config = _.assign({}, allSchemas[plugin.id], plugin.config);</span>
    });
  }
&nbsp;
  // If the user requests to have plugin configurations merged (through the merge_plugins setting in the strider.json)
  // merge the plugin configurations.
  // Here, we do not need to care about the default configuration of a plugin, as the web UI will always have the
  // full configuration schema populated.
<span class="cstat-no" title="statement not covered" >  if (!striderJson.merge_plugins) <span class="cstat-no" title="statement not covered" >return config;</span></span>
<span class="cstat-no" title="statement not covered" >  debug('Merging plugin configurations');</span>
<span class="cstat-no" title="statement not covered" >  config.plugins = mergePlugins(branch.plugins, striderJson.plugins);</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >  return config;</span>
}
&nbsp;
<span class="fstat-no" title="function not covered" >function validateVal(val, schema) {</span>
<span class="cstat-no" title="statement not covered" >  if (schema === String) <span class="cstat-no" title="statement not covered" >return `${val}`;</span></span>
<span class="cstat-no" title="statement not covered" >  if (schema === Number) {</span>
<span class="cstat-no" title="statement not covered" >    val = parseFloat(schema);</span>
<span class="cstat-no" title="statement not covered" >    return isNaN(val) ? 0 : val;</span>
  }
<span class="cstat-no" title="statement not covered" >  if (schema === Boolean) <span class="cstat-no" title="statement not covered" >return !!val;</span></span>
<span class="cstat-no" title="statement not covered" >  if (Array.isArray(schema)) {</span>
<span class="cstat-no" title="statement not covered" >    var ret = [];</span>
<span class="cstat-no" title="statement not covered" >    if (!Array.isArray(val)) <span class="cstat-no" title="statement not covered" >return [];</span></span>
<span class="cstat-no" title="statement not covered" >    for (var i = 0; i &lt; val.length; i++) {</span>
<span class="cstat-no" title="statement not covered" >      ret.push(validateVal(val[i], schema[0]));</span>
    }
<span class="cstat-no" title="statement not covered" >    return ret;</span>
  }
<span class="cstat-no" title="statement not covered" >  if (schema.type &amp;&amp; !schema.type.type) {</span>
<span class="cstat-no" title="statement not covered" >    val = validateVal(val, schema.type);</span>
<span class="cstat-no" title="statement not covered" >    if (schema.enum &amp;&amp; schema.enum.indexOf(val) === -1) {</span>
<span class="cstat-no" title="statement not covered" >      return;</span>
    }
<span class="cstat-no" title="statement not covered" >    return val;</span>
  }
<span class="cstat-no" title="statement not covered" >  if ('object' !== typeof schema) <span class="cstat-no" title="statement not covered" >return;</span></span>
<span class="cstat-no" title="statement not covered" >  if ('object' !== typeof val) <span class="cstat-no" title="statement not covered" >return {};</span></span>
  // if schema is {}, it's unchecked.
<span class="cstat-no" title="statement not covered" >  if (Object.keys(schema).length === 0) <span class="cstat-no" title="statement not covered" >return val;</span></span>
<span class="cstat-no" title="statement not covered" >  return validateAgainstSchema(val, schema);</span>
}
&nbsp;
<span class="fstat-no" title="function not covered" >function defaultVal(val) {</span>
<span class="cstat-no" title="statement not covered" >  if (val === String) <span class="cstat-no" title="statement not covered" >return '';</span></span>
<span class="cstat-no" title="statement not covered" >  if (val === Number) <span class="cstat-no" title="statement not covered" >return 0;</span></span>
<span class="cstat-no" title="statement not covered" >  if (val === Boolean) <span class="cstat-no" title="statement not covered" >return false;</span></span>
<span class="cstat-no" title="statement not covered" >  if (!val) <span class="cstat-no" title="statement not covered" >return null;</span></span>
<span class="cstat-no" title="statement not covered" >  if (Array.isArray(val)) <span class="cstat-no" title="statement not covered" >return [];</span></span>
<span class="cstat-no" title="statement not covered" >  if (val.type &amp;&amp; !val.type.type) {</span>
<span class="cstat-no" title="statement not covered" >    if (val.default) <span class="cstat-no" title="statement not covered" >return val.default;</span></span>
<span class="cstat-no" title="statement not covered" >    if (val.enum) <span class="cstat-no" title="statement not covered" >return val.enum[0];</span></span>
<span class="cstat-no" title="statement not covered" >    return defaultVal(val.type);</span>
  }
<span class="cstat-no" title="statement not covered" >  if ('object' === typeof val) <span class="cstat-no" title="statement not covered" >return defaultSchema(val);</span></span>
<span class="cstat-no" title="statement not covered" >  return null;</span>
}
&nbsp;
<span class="fstat-no" title="function not covered" >function defaultSchema(schema) {</span>
<span class="cstat-no" title="statement not covered" >  var data = {};</span>
<span class="cstat-no" title="statement not covered" >  for (var key in schema) {</span>
<span class="cstat-no" title="statement not covered" >    data[key] = defaultVal(schema[key]);</span>
  }
<span class="cstat-no" title="statement not covered" >  return data;</span>
}
&nbsp;
<span class="fstat-no" title="function not covered" >function validateAgainstSchema(obj, schema) {</span>
<span class="cstat-no" title="statement not covered" >  var data = {};</span>
<span class="cstat-no" title="statement not covered" >  for (var key in obj) {</span>
<span class="cstat-no" title="statement not covered" >    if (!schema[key]) <span class="cstat-no" title="statement not covered" >continue;</span></span>
<span class="cstat-no" title="statement not covered" >    data[key] = validateVal(obj[key], schema[key]);</span>
  }
<span class="cstat-no" title="statement not covered" >  return data;</span>
}
&nbsp;
<span class="fstat-no" title="function not covered" >function timeFromId(id) {</span>
<span class="cstat-no" title="statement not covered" >  return new Date(parseInt(id.toString().substring(0, 8), 16) * 1000);</span>
}
&nbsp;
<span class="fstat-no" title="function not covered" >function sanitizeBranch(branch) {</span>
<span class="cstat-no" title="statement not covered" >  var plugins = [];</span>
<span class="cstat-no" title="statement not covered" >  for (var i = 0; i &lt; branch.plugins; i++) {</span>
<span class="cstat-no" title="statement not covered" >    plugins.push({id: branch.plugins[i].id, enabled: branch.plugins[i].enabled});</span>
  }
<span class="cstat-no" title="statement not covered" >  return {</span>
    plugins: plugins,
    public: branch.public,
    active: branch.active,
    deploy_on_green: branch.deploy_on_green,
    deploy_on_pull_request: branch.deploy_on_pull_request,
    runner: {
      id: branch.runner &amp;&amp; branch.runner.id
    }
  };
}
&nbsp;
<span class="fstat-no" title="function not covered" >function sanitizeUser(user) {</span>
<span class="cstat-no" title="statement not covered" >  for (var i = 0; i &lt; user.accounts.length; i++) {</span>
<span class="cstat-no" title="statement not covered" >    delete user.accounts[i].cache;</span>
  }
<span class="cstat-no" title="statement not covered" >  return user;</span>
}
&nbsp;
<span class="fstat-no" title="function not covered" >function sanitizeProject(project) {</span>
<span class="cstat-no" title="statement not covered" >  return {</span>
    _id: project._id,
    name: project.name,
    branches: project.branches.map(sanitizeBranch),
    public: project.public,
    display_url: project.display_url,
    display_name: project.display_name,
    provider: {
      id: project.provider.id
    }
  };
}
&nbsp;
<span class="fstat-no" title="function not covered" >function gravatarDefault(email) {</span>
<span class="cstat-no" title="statement not covered" >  return gravatar.url(email, {</span>
    d: 'identicon'
  }, true);
}
&nbsp;
&nbsp;</pre></td></tr>
</table></pre>
</div>
<div class="footer">
    <div class="meta">Generated by <a href="https://github.com/kaizhu256/node-utility2" target="_blank">utility2</a> at Wed Apr 19 2017 18:57:28 GMT+0000 (UTC)</div>
</div>
</body>
</html>
